# End-To-End Tests

Each folder in the `scenarios` folder represents one testing scenario.
When `yarn test` is run, first `setup.ts` in all scenarios is executed, afterwards we run `jest`, which will pick up all `*.test.ts` files.
Generally, the `*.test.ts` files can then use anything that is generated via `setup.ts`.

## Snapshot Test Structure

For snapshot tests where files uploaded to Sentry are cpompared with local reference files, it's recommended to stick to the following structure inside a scenario folder:

- `input` contains the JS input files. These will be bundled by all bundlers defined in `utils/bundlers.ts`.
- `ref` contains the reference files. All files that are uploaded to Sentry for one release must be present in this folder, in the same structure as the uploaded filename contains (e.g. `~/index.js`). Because generated JS and source maps look entirely different per bundler, reference files must be specified separately for each bundler.
- `config.ts` contains the bundler plugin config that is used to
  1. Delete a release from Sentry with the given `release` property
  2. Bundle files from `input` and upload them to Sentry
  3. Download the files from Sentry with the for the given `release` property
- `setup.ts` is the starting point to create bundles for all bundlers specified in `utils/bundlers.ts`. Specify the name of your entry point file(s) in this file.
- `*.test.ts` specifies all tests which are executed by Jest for this scenario.

Note that the final release name used per scenario is `[config.release]-[bundler]`. Each scenario will create separate releases for each bundler to distinguish the files generated by the bundlers.
